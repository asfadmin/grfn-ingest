AWSTemplateFormatVersion: 2010-09-09

Parameters:

  LogLevel:
    Type: String
    Default: INFO
    AllowedValues:
    - CRITICAL
    - ERROR
    - WARNING
    - INFO
    - DEBUG

  PrivateBucket:
    Type: String

  PublicBucket:
    Type: String

  DistributionBaseUrl:
    Type: String

  BrowseBaseUrl:
    Type: String

  DefaultResponseTopicArn:
    Type: String

  DefaultResponseTopicRegion:
    Type: String
    Default: us-east-1
    AllowedValues:
    - us-east-2
    - us-east-1
    - us-west-1
    - us-west-2
    - ap-south-1
    - ap-northeast-2
    - ap-southeast-1
    - ap-southeast-2
    - ap-northeast-1
    - ca-central-1
    - cn-north-1
    - eu-central-1
    - eu-west-1
    - eu-west-2
    - eu-west-3
    - sa-east-1

  OregonTopicArn:
    Description: ARN of ingest topic in us-west-2.  Can be removed when we fix JPL access.
    Type: String

  CachedCmrTokenBucket:
    Type: String

  CachedCmrTokenKey:
    Type: String
    Default: cached-cmr-auth-token-test

  CmrTokenLambda:
    Type: String
    Default: cmr-token:TEST

  CmrGranuleUrl:
    Type: String

  IngestContainerImage:
    Type: String

  IngestEc2Timeout:
    Type: Number
    MinValue: 0
    Default: 300

  IngestActivityTimeout:
    Type: Number
    MinValue: 0
    Default: 600

  Maturity:
    Type: String
    Default: DEV
    AllowedValues:
      - TEST
      - PROD
      - DEV

Resources:

  MainStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      Tags:
        - Key: MATURITY
          Value: !Ref Maturity
        - Key: APPLICATION
          Value: GRFN-INGEST
      Parameters:
        Name: !Ref AWS::StackName
        LogLevel: !Ref LogLevel
        PrivateBucket: !Ref PrivateBucket
        PublicBucket: !Ref PublicBucket
        DistributionBaseUrl: !Ref DistributionBaseUrl
        BrowseBaseUrl: !Ref BrowseBaseUrl
        CachedCmrTokenBucket: !Ref CachedCmrTokenBucket
        CachedCmrTokenKey: !Ref CachedCmrTokenKey
        CmrTokenLambda: !Ref CmrTokenLambda
        CmrGranuleUrl: !Ref CmrGranuleUrl
        DefaultResponseTopicArn: !Ref DefaultResponseTopicArn
        DefaultResponseTopicRegion: !Ref DefaultResponseTopicRegion
        IngestContainerImage: !Ref IngestContainerImage
        IngestEc2Timeout: !Ref IngestEc2Timeout
        IngestActivityTimeout: !Ref IngestActivityTimeout
        OregonTopicArn: !Ref OregonTopicArn
      TemplateURL: cloudformation-main.yaml
